{% extends "makeaface/base.html" %}
{% load abs %}

{% block htmlhead %}
    <link rel="stylesheet" type="text/css" href="{% url static path="makeaface/gridwall.css" %}">

    <script type="text/javascript">
    var mycam;

    {% block js_data %}
        var faces = [
        {% for event in events %}
            "{{ event.object.links.rel__enclosure.maxwidth__458.href }}",
        {% endfor %}
            null
        ].slice(0, -1);
    {% endblock%}
    </script>

    <script type="text/javascript" src="{% url static path="makeaface/facething.js" %}"></script>
{% endblock %}

{% block content %}
    <div id="toolbar" class="grid">
        <div class="span-6"></div>
        <div class="span-12"><h1>make a face</h1></div>
        <div class="span-6 last">
            {% if user.is_anonymous %}
                <p>Hi! <a href="{% url login %}">Sign in</a> to face</p>
            {% else %}
                <p>Hi, {{ user.display_name }}! <a href="{% url logout %}">Sign out</a></p>
            {% endif %}
        </div>
    </div><br style="clear: both">

    <div id="gridsizer"></div>
    <div id="gridcontainer"></div>

    {% if user.is_authenticated %}
    <script type="text/javascript">
        $(document).bind('initializedgrid', function (event) {
            var cell = cells[0][-1];
            cell.setBothspan(3);
            cell.elem.attr("id", "camera");

            cameraman.url = '{% url static path="makeaface/" %}';
            mycam = cameraman.createCamera({
                'id': 'camera',
                'width': spanSize(3),
                'height': spanSize(3),
                'sendto': '{% absoluteurl %}{% url upload_photo %}{% endabsoluteurl %}',
                'errorSending': function(cam, err) { alert('OOPS: ' + err) },
                'tookPhoto': function(cam) { tookPhoto(cam) },
                //'droppedPhoto': function(cam) { droppedPhoto(cam) },
                'sentPhoto': function(cam, url) { sentPhoto(cam, url) }
            });
        });
    </script>
    {% endif %}
{% endblock %}

{% block old_content %}
    {% if user.is_anonymous %}
        <p>Hi! <a href="{% url login %}">Sign in</a></p>
    {% else %}
        <p>Hi, {{ user.display_name }}! <a href="{% url logout %}">Sign out</a></p>
    {% endif %}

    {% if user.is_authenticated %}
    <div id="camera"></div>

    <script type="text/javascript" src="{% url static path="makeaface/cameraman.js" %}"></script>
    <script type="text/javascript">
        cameraman.url = '{% url static path="makeaface/" %}';
        var mycam = cameraman.createCamera({
            'id': 'camera',
            'width': '400',
            'height': '400',
            'sendto': '{% absoluteurl %}{% url upload_photo %}{% endabsoluteurl %}',
            'errorSending': function(cam, err) { alert('OOPS: ' + err) },
            'tookPhoto': function(cam) { tookPhoto(cam) },
            //'droppedPhoto': function(cam) { droppedPhoto(cam) },
            'sentPhoto': function(cam, url) { sentPhoto(cam, url) }
        });
    </script>

    <p><button id="take-picture">Take picture</button></p>

    <script type="text/javascript">
        $('#take-picture').click(function () {
            mycam.takePhoto();
        });
        function tookPhoto(cam) {
            cam.sendPhoto();
        }
        function sentPhoto(cam, url) {
            window.location.href = url;
        }
    </script>
    {% endif %}

    {% for pic in events %}
        <div>HI A PHOTO: {{ pic.object.links.rel__enclosure.maxwidth__458.href }}</div>
    {% endfor %}

{% endblock %}
